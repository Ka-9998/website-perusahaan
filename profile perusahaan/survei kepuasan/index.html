<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Umpan Balik dengan Analisis Gemini</title>
    <!-- Memuat Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Memuat Font Inter dari Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-left-color: #fff;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        /* Custom modal styles */
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="bg-slate-900 text-white flex items-center justify-center min-h-screen p-4">

    <div class="bg-slate-800 p-8 rounded-2xl shadow-2xl w-full max-w-2xl">

        <!-- Form utama -->
        <form id="feedbackForm" action="https://formspree.io/f/mwpbylga" method="POST">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-indigo-400">Umpan Balik Pengalaman Pengguna</h1>
                <p class="text-slate-400 mt-2">Masukan Anda sangat berharga untuk membantu kami menjadi lebih baik.</p>
            </div>

            <div class="space-y-6">
                <!-- Pertanyaan-pertanyaan -->
                <div>
                    <label for="q1-visual" class="block text-sm font-medium text-slate-300 mb-2">1. Kesan Pertama & Desain Visual</label>
                    <textarea id="q1-visual" name="visual_impression" rows="4" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="Bagaimana kesan pertama Anda saat melihat desain situs/aplikasi kami?"></textarea>
                </div>
                <div>
                    <label for="q2-navigation" class="block text-sm font-medium text-slate-300 mb-2">2. Navigasi & Kemudahan Menemukan Informasi</label>
                    <textarea id="q2-navigation" name="navigation_experience" rows="4" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="Ceritakan pengalaman Anda saat mencoba mencari suatu halaman atau informasi spesifik."></textarea>
                </div>
                <div>
                    <label for="q3-mobile" class="block text-sm font-medium text-slate-300 mb-2">3. Pengalaman di Perangkat Mobile</label>
                    <textarea id="q3-mobile" name="mobile_experience" rows="4" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="Jika Anda mengakses melalui ponsel, bagaimana tampilannya?"></textarea>
                </div>
                <div>
                    <label for="q4-features" class="block text-sm font-medium text-slate-300 mb-2">4. Interaksi dengan Fitur Spesifik</label>
                    <textarea id="q4-features" name="feature_interaction" rows="4" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="Bagaimana pengalaman Anda saat menggunakan formulir kontak, pendaftaran, dll?"></textarea>
                </div>
                <div>
                    <label for="q5-additional" class="block text-sm font-medium text-slate-300 mb-2">5. Umpan Balik Tambahan (Opsional)</label>
                    <textarea id="q5-additional" name="additional_feedback" rows="4" class="w-full bg-slate-700 border border-slate-600 rounded-lg p-3 text-white placeholder-slate-500 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition duration-200" placeholder="Apakah ada hal lain yang ingin Anda sampaikan?"></textarea>
                </div>
            </div>

            <!-- Tombol Submit -->
            <div class="mt-8">
                <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-4 rounded-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-indigo-500 transition duration-300 flex items-center justify-center" id="submitButton">
                    Kirim Umpan Balik
                </button>
            </div>
        </form>

        <!-- Container untuk pesan sukses dan fitur Gemini -->
        <div id="resultContainer" class="hidden text-center">
            <div id="successMessage" class="mb-6">
                <svg class="mx-auto h-16 w-16 text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h2 class="mt-4 text-2xl font-bold text-green-400">Terima Kasih!</h2>
                <p class="mt-2 text-slate-300">Umpan balik Anda telah berhasil dikirim.</p>
            </div>

            <!-- Tombol Aksi Gemini -->
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="summarizeButton" class="w-full sm:w-auto bg-sky-500 hover:bg-sky-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center">
                    <span class="mr-2">✨</span> Ringkas Umpan Balik
                </button>
                <button id="insightsButton" class="w-full sm:w-auto bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 flex items-center justify-center" disabled>
                     <span class="mr-2">✨</span> Buat Wawasan & Tindakan
                </button>
            </div>

             <!-- Kontainer untuk menampilkan hasil dari Gemini -->
            <div id="geminiOutput" class="mt-6 p-6 bg-slate-900 rounded-lg text-left hidden">
                <h3 id="outputTitle" class="text-xl font-bold text-indigo-400 mb-4"></h3>
                <div id="outputContent" class="text-slate-300 whitespace-pre-wrap"></div>
                 <div id="loadingIndicator" class="hidden justify-center items-center mt-4">
                    <div class="spinner"></div>
                    <p class="ml-3 text-slate-400">Gemini sedang berpikir...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Elemen DOM
        const form = document.getElementById('feedbackForm');
        const submitButton = document.getElementById('submitButton');
        const resultContainer = document.getElementById('resultContainer');
        const successMessage = document.getElementById('successMessage');
        const summarizeButton = document.getElementById('summarizeButton');
        const insightsButton = document.getElementById('insightsButton');
        const geminiOutput = document.getElementById('geminiOutput');
        const outputTitle = document.getElementById('outputTitle');
        const outputContent = document.getElementById('outputContent');
        const loadingIndicator = document.getElementById('loadingIndicator');

        let allFeedbackText = '';
        let summaryText = '';

        // Fungsi untuk memanggil Gemini API
        async function callGemini(prompt) {
            loadingIndicator.classList.remove('hidden');
            loadingIndicator.classList.add('flex');
            geminiOutput.classList.remove('hidden');
            outputContent.innerHTML = ''; // Kosongkan konten sebelumnya

            try {
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // Disediakan oleh environment
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    return text;
                } else {
                    throw new Error("Respons API tidak valid.");
                }

            } catch (error) {
                console.error('Error calling Gemini API:', error);
                return `Maaf, terjadi kesalahan saat menghubungi Gemini. Detail: ${error.message}`;
            } finally {
                loadingIndicator.classList.add('hidden');
                loadingIndicator.classList.remove('flex');
            }
        }


        // Event listener untuk submit form
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(form);

            allFeedbackText = `
                Kesan Visual: ${formData.get('visual_impression')}
                Navigasi: ${formData.get('navigation_experience')}
                Pengalaman Mobile: ${formData.get('mobile_experience')}
                Interaksi Fitur: ${formData.get('feature_interaction')}
                Tambahan: ${formData.get('additional_feedback')}
            `;

            // Nonaktifkan tombol saat mengirim
            submitButton.disabled = true;
            submitButton.innerHTML = '<div class="spinner"></div>';

            fetch(form.action, {
                method: 'POST',
                body: formData,
                headers: { 'Accept': 'application/json' }
            }).then(response => {
                if (response.ok) {
                    form.style.display = 'none';
                    resultContainer.classList.remove('hidden');
                } else {
                    response.json().then(data => {
                        alert(data.errors ? data.errors.map(err => err.message).join(", ") : 'Oops! Terjadi masalah.');
                    });
                }
            }).catch(error => {
                alert('Oops! Terjadi masalah jaringan.');
            }).finally(() => {
                // Aktifkan kembali tombol jika terjadi error, atau biarkan tersembunyi jika sukses
                submitButton.disabled = false;
                submitButton.innerHTML = 'Kirim Umpan Balik';
            });
        });

        // Event listener untuk tombol ringkasan
        summarizeButton.addEventListener('click', async () => {
            const prompt = `Anda adalah seorang analis UX yang ahli. Ringkaslah umpan balik pengguna berikut dalam 2-3 kalimat utama. Fokus pada poin-poin paling penting.\n\nUmpan Balik:\n${allFeedbackText}`;
            
            outputTitle.innerText = "Ringkasan Umpan Balik";
            summaryText = await callGemini(prompt);
            outputContent.innerText = summaryText;

            // Aktifkan tombol wawasan setelah ringkasan dibuat
            insightsButton.disabled = false;
        });

        // Event listener untuk tombol wawasan
        insightsButton.addEventListener('click', async () => {
            const prompt = `Berdasarkan ringkasan umpan balik pengguna berikut, buatlah daftar wawasan (insights) dan saran tindakan (actionable items) untuk tim produk/desain. Gunakan format Markdown dengan heading untuk "Wawasan Utama" dan "Saran Tindakan".\n\nRingkasan:\n${summaryText}`;
            
            outputTitle.innerText = "Wawasan & Saran Tindakan";
            const insights = await callGemini(prompt);
            outputContent.innerText = insights;
        });
    </script>
</body>
</html>
